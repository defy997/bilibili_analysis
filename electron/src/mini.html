<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mini</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
    }
    .icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
      cursor: pointer;
      -webkit-app-region: no-drag;
    }
  </style>
</head>
<body>
  <div id="dragRegion" style="-webkit-app-region: drag; width: 64px; height: 64px; display:flex; align-items:center; justify-content:center;">
    <div class="icon" id="restoreBtn" title="ç‚¹å‡»è¿˜åŸæ‚¬æµ®çª—" style="-webkit-app-region: no-drag;">ğŸ”</div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const btn = document.getElementById('restoreBtn');
    btn.addEventListener('click', () => {
      ipcRenderer.send('restore-window');
    });

    // åŒå‡»ä¹Ÿè¿˜åŸ
    btn.addEventListener('dblclick', () => {
      ipcRenderer.send('restore-window');
    });

    // å³é”®æ˜¾ç¤ºèœå•ï¼šè¿˜åŸ / å…³é—­
    window.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      ipcRenderer.send('show-mini-context-menu');
    });

    // å®ç°æ‰‹åŠ¨æ‹–æ‹½ï¼ˆåœ¨æŸäº›å¹³å°ä¸‹ -webkit-app-region æœ‰æ—¶è¡Œä¸ºä¸ç¨³å®šï¼‰
    (async () => {
      const dragRegion = document.getElementById('dragRegion');
      let dragging = false;
      let offsetX = 0;
      let offsetY = 0;

      dragRegion.addEventListener('mousedown', async (ev) => {
        // å¦‚æœç‚¹å‡»çš„æ˜¯å®é™…æŒ‰é’®ï¼Œä¸è§¦å‘æ‹–æ‹½
        if (ev.target && ev.target.id === 'restoreBtn') return;
        dragging = true;
        const startScreenX = ev.screenX;
        const startScreenY = ev.screenY;
        // è¯·æ±‚å½“å‰çª—å£ bounds
        const bounds = await ipcRenderer.invoke('mini-begin-drag', { screenX: startScreenX, screenY: startScreenY });
        offsetX = startScreenX - bounds.x;
        offsetY = startScreenY - bounds.y;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp, { once: true });
      });

      function onMouseMove(ev) {
        if (!dragging) return;
        ipcRenderer.send('mini-update-drag', { screenX: ev.screenX, screenY: ev.screenY, offsetX, offsetY });
      }

      function onMouseUp() {
        dragging = false;
        document.removeEventListener('mousemove', onMouseMove);
      }
    })();
  </script>
</body>
</html>


