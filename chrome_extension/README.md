# B站视频情感分析助手 - Chrome扩展

这是一个Chrome浏览器扩展，用于监测B站视频页面的变化，并将视频信息发送给悬浮窗口应用进行情感分析。

## 功能特性

- 🎥 **视频监控**：自动检测B站视频页面的BV号变化
- 🔄 **实时同步**：通过WebSocket与悬浮窗口实时通信
- 🎯 **精准识别**：支持多种B站URL格式的视频识别
- 🔄 **自动重连**：网络断开时自动尝试重连
- 📊 **状态反馈**：详细的控制台日志输出

## 安装步骤

### 1. 下载扩展文件

确保你有以下文件：
- `manifest.json`
- `content.js`
- `background.js`
- `welcome.html`
- 图标文件 (icon16.png, icon48.png, icon128.png)

### 2. 加载到Chrome

1. 打开Chrome浏览器
2. 在地址栏输入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择包含扩展文件的文件夹

### 3. 验证安装

安装完成后，你应该会看到扩展图标出现在扩展栏中。

## 使用方法

1. **启动悬浮窗口**：运行Electron悬浮窗口应用
2. **启用扩展**：点击扩展图标，确保扩展已启用
3. **访问B站**：打开任意B站视频页面
4. **查看分析**：悬浮窗口会自动显示当前视频的情感分析结果

## 技术实现

### 内容脚本 (content.js)

- 注入到B站视频页面中
- 监控URL变化，提取BV号
- 通过WebSocket连接悬浮窗口
- 处理页面标题获取和错误处理

### 后台脚本 (background.js)

- 处理扩展生命周期事件
- 管理扩展状态和配置
- 提供工具函数给其他脚本使用

### 通信协议

#### 发送给悬浮窗口的消息格式：

```javascript
// 视频变化通知
{
  "type": "VIDEO_CHANGE",
  "bvId": "BV1xx411x7x1",
  "url": "https://www.bilibili.com/video/BV1xx411x7x1",
  "timestamp": 1703123456789,
  "title": "视频标题"
}

// 扩展连接通知
{
  "type": "EXTENSION_CONNECTED",
  "timestamp": 1703123456789
}
```

#### 接收来自悬浮窗口的消息：

```javascript
// 心跳包
{
  "type": "PING"
}

// 请求当前视频信息
{
  "type": "REQUEST_CURRENT_VIDEO"
}
```

## 权限说明

扩展需要以下权限：

- `activeTab`: 访问当前活动标签页
- `storage`: 本地存储设置
- `host_permissions`: 访问B站域名下的页面

## 故障排除

### 扩展无法加载

- 确保所有必需文件都在同一文件夹中
- 检查manifest.json格式是否正确
- 尝试刷新扩展页面

### 无法连接到悬浮窗口

- 确认悬浮窗口应用已启动
- 检查端口3000是否被其他程序占用
- 查看浏览器控制台的错误信息

### 视频切换无响应

- 确认在B站视频页面
- 检查扩展图标是否亮起（表示激活状态）
- 查看扩展的后台页面日志

### 调试方法

1. **查看扩展日志**：
   - 右键点击扩展图标 → "检查弹出页面"
   - 或访问 `chrome://extensions/` → 扩展详情 → "后台页面"

2. **查看内容脚本日志**：
   - 在B站视频页面按F12打开开发者工具
   - 在Console标签页查看日志

3. **测试WebSocket连接**：
   - 在控制台输入：`new WebSocket('ws://localhost:3000')`

## 开发调试

### 本地开发

1. 修改代码后重新加载扩展
2. 使用 `console.log()` 输出调试信息
3. 在开发者工具中设置断点

### 版本更新

更新扩展时：
1. 修改manifest.json中的version字段
2. 重新加载扩展
3. 测试新功能是否正常工作

## 兼容性

- **Chrome**: 88+
- **Edge**: 88+
- **Opera**: 74+
- **其他Chromium内核浏览器**: 支持

## 注意事项

- 扩展仅在B站视频页面激活
- 需要悬浮窗口应用配合使用
- 首次使用可能需要一些时间建立连接
- 网络不稳定时会自动重连

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的视频监控和WebSocket通信
- 包含完整的错误处理和重连机制

## 贡献

欢迎提交Issue和Pull Request来改进这个扩展！
